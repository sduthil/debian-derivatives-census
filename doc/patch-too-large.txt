This patch was too large to be useful so it was removed.
