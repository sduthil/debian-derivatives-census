#!/usr/bin/python

import os
import sys

template = '''[%s]
name = %s
face = %s

'''


try: os.makedirs(sys.argv[3])
except OSError: pass

df = open(sys.argv[1])
f = open(sys.argv[2], 'w')
for d in df:
	d = d.strip()
	if not d: continue
	name = open(os.path.join(d,'name')).read().strip()
	src = os.path.abspath(os.path.join(d,'logo-img'))
	if os.path.exists(src):
		dst = os.path.abspath(os.path.join(sys.argv[3],d))
		try: os.remove(dst)
		except: pass
		os.symlink(os.path.relpath(src,sys.argv[3]),dst)
	try:
		rf = open(os.path.join(d,'blogs-rss'))
		for rss in rf:
			if not rss.strip(): continue
			args = (rss.strip(), name, 'deriv/%s' % d)
			f.write(template % args)
		rf.close()
	except:
		pass
	try:
		rf = open(os.path.join(d,'blogs-dev-rss'))
		for rss in rf:
			if not rss.strip(): continue
			args = (rss.strip(), name + ' developers', 'deriv/%s' % d)
			f.write(template % args)
		rf.close()
	except:
		pass
f.close()
df.close()
